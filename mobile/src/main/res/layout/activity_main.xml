<?xml version="1.0" encoding="utf-8"?>
<androidx.coordinatorlayout.widget.CoordinatorLayout xmlns:android="http://schemas.android.com/apk/res/android"
    xmlns:app="http://schemas.android.com/apk/res-auto"
    xmlns:tools="http://schemas.android.com/tools" android:layout_width="match_parent" android:layout_height="match_parent" android:background="@drawable/bg_asphalt_main" android:fitsSystemWindows="true" tools:context=".MainActivity">

    <androidx.core.widget.NestedScrollView android:layout_width="match_parent" android:layout_height="match_parent" android:fillViewport="true">

        <androidx.constraintlayout.widget.ConstraintLayout android:layout_width="match_parent" android:layout_height="wrap_content" android:padding="16dp">

            <!-- Match Timer Section -->
            <com.google.android.material.card.MaterialCardView android:id="@+id/timer_card" android:layout_width="0dp" android:layout_height="wrap_content" style="?attr/materialCardViewElevatedStyle" app:cardBackgroundColor="@android:color/transparent" app:cardElevation="4dp" app:shapeAppearance="@style/ShapeAppearance.App.StreetCard" app:layout_constraintTop_toTopOf="parent" app:layout_constraintStart_toStartOf="parent" app:layout_constraintEnd_toEndOf="parent">

                <LinearLayout android:layout_width="match_parent" android:layout_height="wrap_content" android:background="@drawable/bg_concrete_card" android:orientation="vertical" android:padding="16dp" android:gravity="center">

                    <LinearLayout android:layout_width="match_parent" android:layout_height="wrap_content" android:orientation="horizontal" android:gravity="end" android:layout_marginBottom="8dp">

                        <ImageButton android:id="@+id/settings_button" android:layout_width="32dp" android:layout_height="32dp" android:src="@drawable/ic_settings" android:background="?attr/selectableItemBackgroundBorderless" android:contentDescription="@string/cd_settings" app:tint="@color/sidewalk_gray" android:layout_marginEnd="16dp"/>

                        <ImageView android:id="@+id/wear_status_icon" android:layout_width="32dp" android:layout_height="32dp" android:src="@drawable/ic_watch_disconnected" android:contentDescription="@string/cd_wear_status" tools:src="@drawable/ic_watch_connected"/>
                    </LinearLayout>

                    <TextView android:layout_width="wrap_content" android:layout_height="wrap_content" android:text="MATCH TIME" android:textAppearance="?attr/textAppearanceHeadlineMedium" android:textColor="@color/sidewalk_gray" android:textSize="14sp"/>

                    <TextView android:id="@+id/timer_textview" android:layout_width="wrap_content" android:layout_height="wrap_content" android:text="00:00" android:textAppearance="?attr/textAppearanceDisplayLarge" android:layout_marginTop="4dp"/>

                    <TextView android:id="@+id/keeper_timer_textview" android:layout_width="wrap_content" android:layout_height="wrap_content" android:text="05:00" android:textAppearance="?attr/textAppearanceHeadlineMedium" android:textColor="?attr/colorPrimary" android:layout_marginTop="8dp" android:visibility="visible"/>

                    <LinearLayout android:layout_width="wrap_content" android:layout_height="wrap_content" android:orientation="horizontal" android:layout_marginTop="12dp">

                        <com.google.android.material.button.MaterialButton android:id="@+id/timer_start_button" style="@style/Widget.App.Button.Street" android:layout_width="wrap_content" android:layout_height="wrap_content" android:text="START" android:onClick="startStopTimer" android:layout_marginEnd="8dp"/>

                        <com.google.android.material.button.MaterialButton android:id="@+id/reset_timer_button" style="@style/Widget.App.Button.TextButton.Street" android:layout_width="wrap_content" android:layout_height="wrap_content" android:text="RESET" android:onClick="resetTimer"/>
                    </LinearLayout>

                    <com.google.android.material.button.MaterialButton android:id="@+id/undo_goal_button" style="@style/Widget.App.Button.TextButton.Street" android:layout_width="wrap_content" android:layout_height="wrap_content" android:layout_marginTop="8dp" android:text="UNDO LAST GOAL" android:textColor="@color/error_red" app:icon="@drawable/ic_undo" app:iconTint="@color/error_red" android:visibility="gone" tools:visibility="visible"/>
                </LinearLayout>
            </com.google.android.material.card.MaterialCardView>

            <!-- Score Section - NUOVA SEZIONE SCORE RESPONSIVE -->
            <androidx.constraintlayout.widget.ConstraintLayout android:id="@+id/score_section" android:layout_width="0dp" android:layout_height="wrap_content" android:minHeight="300dp" android:layout_marginTop="16dp" app:layout_constraintTop_toBottomOf="@id/timer_card" app:layout_constraintStart_toStartOf="parent" app:layout_constraintEnd_toEndOf="parent">

                <!-- Team 1 Side with layout migliorato -->
                <com.google.android.material.card.MaterialCardView android:id="@+id/team1_card" android:layout_width="0dp" android:layout_height="wrap_content" android:minHeight="280dp" app:cardBackgroundColor="@color/team_spray_yellow" app:shapeAppearance="@style/ShapeAppearance.App.StreetCard" app:cardElevation="8dp" android:layout_marginEnd="4dp" app:rippleColor="@color/stencil_white" app:layout_constraintTop_toTopOf="parent" app:layout_constraintBottom_toBottomOf="parent" app:layout_constraintStart_toStartOf="parent" app:layout_constraintEnd_toStartOf="@id/guideline_center">

                    <androidx.constraintlayout.widget.ConstraintLayout android:layout_width="match_parent" android:layout_height="match_parent" android:padding="12dp">

                        <!-- Nome Team Cliccabile invece di EditText -->
                        <LinearLayout android:id="@+id/team1_name_container" android:layout_width="match_parent" android:layout_height="wrap_content" android:orientation="horizontal" android:gravity="center" android:background="?attr/selectableItemBackgroundBorderless" android:padding="8dp" android:contentDescription="@string/cd_edit_team_1_name" app:layout_constraintTop_toTopOf="parent" app:layout_constraintStart_toStartOf="parent" app:layout_constraintEnd_toEndOf="parent">

                            <TextView android:id="@+id/team1_name_textview" android:layout_width="wrap_content" android:layout_height="wrap_content" android:text="TEAM 1" android:textAlignment="center" android:textColor="@color/concrete_gray" android:textAppearance="?attr/textAppearanceHeadlineMedium" android:textSize="20sp"/>

                        </LinearLayout>

                        <!-- Score con animazione -->
                        <FrameLayout android:layout_width="match_parent" android:layout_height="wrap_content" app:layout_constraintTop_toBottomOf="@id/team1_name_container" app:layout_constraintBottom_toTopOf="@id/team1_controls_container" app:layout_constraintStart_toStartOf="parent" app:layout_constraintEnd_toEndOf="parent">

                            <TextView android:id="@+id/team1_score_textview" android:layout_width="wrap_content" android:layout_height="wrap_content" android:layout_gravity="center" android:text="0" android:textColor="@color/concrete_gray" android:textSize="86sp" android:fontFamily="sans-serif-condensed" android:textStyle="bold" android:includeFontPadding="false" android:shadowColor="@color/asphalt_dark" android:shadowDx="3" android:shadowDy="3" android:shadowRadius="6" />

                        </FrameLayout>

                        <!-- Controlli migliorati con gesture -->
                        <LinearLayout android:id="@+id/team1_controls_container" android:layout_width="match_parent" android:layout_height="wrap_content" android:orientation="horizontal" android:gravity="center" android:paddingVertical="8dp" app:layout_constraintBottom_toBottomOf="parent" app:layout_constraintStart_toStartOf="parent" app:layout_constraintEnd_toEndOf="parent">

                            <!-- Pulsante Meno pi첫 grande e accessibile -->
                            <com.google.android.material.card.MaterialCardView android:id="@+id/team1_subtract_button_card" android:layout_width="60dp" android:layout_height="60dp" android:layout_marginEnd="20dp" app:cardBackgroundColor="@color/concrete_gray" app:shapeAppearance="@style/ShapeAppearance.App.StreetButton" app:cardElevation="4dp" app:rippleColor="@color/error_red" android:contentDescription="@string/cd_decrease_team_1">

                                <ImageView android:layout_width="match_parent" android:layout_height="match_parent" android:padding="16dp" android:src="@drawable/ic_minus" app:tint="@color/stencil_white" />
                            </com.google.android.material.card.MaterialCardView>

                            <!-- Pulsante Pi첫 prominente -->
                            <com.google.android.material.card.MaterialCardView android:id="@+id/team1_add_button_card" android:layout_width="72dp" android:layout_height="72dp" app:cardBackgroundColor="@color/graffiti_pink" app:shapeAppearance="@style/ShapeAppearance.App.StreetButton" app:cardElevation="8dp" app:rippleColor="@color/stencil_white" android:contentDescription="@string/cd_increase_team_1">

                                <ImageView android:layout_width="match_parent" android:layout_height="match_parent" android:padding="18dp" android:src="@drawable/ic_plus" app:tint="@color/stencil_white" />
                            </com.google.android.material.card.MaterialCardView>
                        </LinearLayout>
                    </androidx.constraintlayout.widget.ConstraintLayout>
                </com.google.android.material.card.MaterialCardView>

                <!-- Team 2 Side -->
                <com.google.android.material.card.MaterialCardView android:id="@+id/team2_card" android:layout_width="0dp" android:layout_height="wrap_content" android:minHeight="280dp" app:cardBackgroundColor="@color/neon_cyan" app:shapeAppearance="@style/ShapeAppearance.App.StreetCard" app:cardElevation="8dp" android:layout_marginStart="4dp" app:rippleColor="@color/stencil_white" app:layout_constraintTop_toTopOf="parent" app:layout_constraintBottom_toBottomOf="parent" app:layout_constraintStart_toEndOf="@id/guideline_center" app:layout_constraintEnd_toEndOf="parent">

                    <androidx.constraintlayout.widget.ConstraintLayout android:layout_width="match_parent" android:layout_height="match_parent" android:padding="12dp">

                        <!-- Nome Team Cliccabile invece di EditText -->
                        <LinearLayout android:id="@+id/team2_name_container" android:layout_width="match_parent" android:layout_height="wrap_content" android:orientation="horizontal" android:gravity="center" android:background="?attr/selectableItemBackgroundBorderless" android:padding="8dp" android:contentDescription="@string/cd_edit_team_2_name" app:layout_constraintTop_toTopOf="parent" app:layout_constraintStart_toStartOf="parent" app:layout_constraintEnd_toEndOf="parent">

                            <TextView android:id="@+id/team2_name_textview" android:layout_width="wrap_content" android:layout_height="wrap_content" android:text="TEAM 2" android:textAlignment="center" android:textColor="@color/concrete_gray" android:textAppearance="?attr/textAppearanceHeadlineMedium" android:textSize="20sp"/>

                        </LinearLayout>

                        <!-- Score con animazione -->
                        <FrameLayout android:layout_width="match_parent" android:layout_height="wrap_content" app:layout_constraintTop_toBottomOf="@id/team2_name_container" app:layout_constraintBottom_toTopOf="@id/team2_controls_container" app:layout_constraintStart_toStartOf="parent" app:layout_constraintEnd_toEndOf="parent">

                            <TextView android:id="@+id/team2_score_textview" android:layout_width="wrap_content" android:layout_height="wrap_content" android:layout_gravity="center" android:text="0" android:textColor="@color/concrete_gray" android:textSize="86sp" android:fontFamily="sans-serif-condensed" android:textStyle="bold" android:includeFontPadding="false" android:shadowColor="@color/asphalt_dark" android:shadowDx="3" android:shadowDy="3" android:shadowRadius="6" />

                        </FrameLayout>

                        <!-- Controlli migliorati con gesture -->
                        <LinearLayout android:id="@+id/team2_controls_container" android:layout_width="match_parent" android:layout_height="wrap_content" android:orientation="horizontal" android:gravity="center" android:paddingVertical="8dp" app:layout_constraintBottom_toBottomOf="parent" app:layout_constraintStart_toStartOf="parent" app:layout_constraintEnd_toEndOf="parent">

                            <!-- Pulsante Meno pi첫 grande e accessibile -->
                            <com.google.android.material.card.MaterialCardView android:id="@+id/team2_subtract_button_card" android:layout_width="60dp" android:layout_height="60dp" android:layout_marginEnd="20dp" app:cardBackgroundColor="@color/concrete_gray" app:shapeAppearance="@style/ShapeAppearance.App.StreetButton" app:cardElevation="4dp" app:rippleColor="@color/error_red" android:contentDescription="@string/cd_decrease_team_2">

                                <ImageView android:layout_width="match_parent" android:layout_height="match_parent" android:padding="16dp" android:src="@drawable/ic_minus" app:tint="@color/stencil_white" />
                            </com.google.android.material.card.MaterialCardView>

                            <!-- Pulsante Pi첫 prominente -->
                            <com.google.android.material.card.MaterialCardView android:id="@+id/team2_add_button_card" android:layout_width="72dp" android:layout_height="72dp" app:cardBackgroundColor="@color/graffiti_pink" app:shapeAppearance="@style/ShapeAppearance.App.StreetButton" app:cardElevation="8dp" app:rippleColor="@color/stencil_white" android:contentDescription="@string/cd_increase_team_2">

                                <ImageView android:layout_width="match_parent" android:layout_height="match_parent" android:padding="18dp" android:src="@drawable/ic_plus" app:tint="@color/stencil_white" />
                            </com.google.android.material.card.MaterialCardView>
                        </LinearLayout>
                    </androidx.constraintlayout.widget.ConstraintLayout>
                </com.google.android.material.card.MaterialCardView>

                <!-- Indicatore centrale VS animato -->
                <com.google.android.material.card.MaterialCardView android:id="@+id/vs_indicator" android:layout_width="48dp" android:layout_height="48dp" app:cardBackgroundColor="@color/asphalt_dark" app:shapeAppearance="@style/ShapeAppearance.App.StreetButton" app:cardElevation="12dp" app:layout_constraintTop_toTopOf="parent" app:layout_constraintBottom_toBottomOf="parent" app:layout_constraintStart_toStartOf="@id/guideline_center" app:layout_constraintEnd_toEndOf="@id/guideline_center">

                    <TextView android:layout_width="match_parent" android:layout_height="match_parent" android:text="VS" android:gravity="center" android:textColor="@color/neon_cyan" android:textSize="18sp" android:fontFamily="sans-serif-black" />
                </com.google.android.material.card.MaterialCardView>

                <androidx.constraintlayout.widget.Guideline android:id="@+id/guideline_center" android:layout_width="wrap_content" android:layout_height="wrap_content" android:orientation="vertical" app:layout_constraintGuide_percent="0.5" />
            </androidx.constraintlayout.widget.ConstraintLayout>


            <!-- Team Rosters Section (Scrollable) -->
            <com.google.android.material.card.MaterialCardView android:id="@+id/rosters_card" style="?attr/materialCardViewElevatedStyle" android:layout_width="0dp" android:layout_height="wrap_content" android:layout_marginTop="16dp" app:cardBackgroundColor="@android:color/transparent" app:cardElevation="4dp" app:shapeAppearance="@style/ShapeAppearance.App.StreetCard" app:layout_constraintTop_toBottomOf="@id/score_section" app:layout_constraintStart_toStartOf="parent" app:layout_constraintEnd_toEndOf="parent">

                <LinearLayout android:layout_width="match_parent" android:layout_height="wrap_content" android:background="@drawable/bg_concrete_card" android:orientation="vertical" android:padding="16dp">

                    <TextView android:layout_width="wrap_content" android:layout_height="wrap_content" android:text="TEAM ROSTERS" android:textAppearance="?attr/textAppearanceHeadlineMedium" android:textColor="@color/sidewalk_gray" android:textSize="14sp" android:layout_marginBottom="12dp"/>

                    <LinearLayout android:layout_width="match_parent" android:layout_height="wrap_content" android:orientation="horizontal">

                        <!-- Team 1 Roster -->
                        <LinearLayout android:layout_width="0dp" android:layout_height="wrap_content" android:layout_weight="1" android:orientation="vertical" android:layout_marginEnd="8dp">

                            <TextView android:layout_width="wrap_content" android:layout_height="wrap_content" android:text="Team 1" android:textAppearance="?attr/textAppearanceHeadlineSmall" android:textColor="?attr/colorPrimary" android:layout_marginBottom="8dp"/>

                            <androidx.recyclerview.widget.RecyclerView android:id="@+id/team1_roster_recyclerview" android:layout_width="match_parent" android:layout_height="150dp" android:nestedScrollingEnabled="false"/>

                            <com.google.android.material.button.MaterialButton android:id="@+id/add_team1_player_button" style="@style/Widget.App.Button.TextButton.Street" android:layout_width="wrap_content" android:layout_height="wrap_content" android:text="Add Player" android:layout_marginTop="8dp"/>
                        </LinearLayout>

                        <!-- Team 2 Roster -->
                        <LinearLayout android:layout_width="0dp" android:layout_height="wrap_content" android:layout_weight="1" android:orientation="vertical" android:layout_marginStart="8dp">

                            <TextView android:layout_width="wrap_content" android:layout_height="wrap_content" android:text="Team 2" android:textAppearance="?attr/textAppearanceHeadlineSmall" android:textColor="?attr/colorSecondary" android:layout_marginBottom="8dp"/>

                            <androidx.recyclerview.widget.RecyclerView android:id="@+id/team2_roster_recyclerview" android:layout_width="match_parent" android:layout_height="150dp" android:nestedScrollingEnabled="false"/>

                            <com.google.android.material.button.MaterialButton android:id="@+id/add_team2_player_button" style="@style/Widget.App.Button.TextButton.Street" android:layout_width="wrap_content" android:layout_height="wrap_content" android:text="Add Player" android:layout_marginTop="8dp"/>
                        </LinearLayout>
                    </LinearLayout>
                </LinearLayout>
            </com.google.android.material.card.MaterialCardView>

            <!-- Match Log Section -->
            <com.google.android.material.card.MaterialCardView android:id="@+id/match_log_card" style="?attr/materialCardViewElevatedStyle" android:layout_width="0dp" android:layout_height="wrap_content" android:layout_marginTop="16dp" app:cardBackgroundColor="@android:color/transparent" app:cardElevation="4dp" app:shapeAppearance="@style/ShapeAppearance.App.StreetCard" app:layout_constraintTop_toBottomOf="@id/rosters_card" app:layout_constraintStart_toStartOf="parent" app:layout_constraintEnd_toEndOf="parent">

                <LinearLayout android:layout_width="match_parent" android:layout_height="wrap_content" android:background="@drawable/bg_concrete_card" android:orientation="vertical" android:padding="16dp">

                    <TextView android:layout_width="wrap_content" android:layout_height="wrap_content" android:text="MATCH LOG" android:textAppearance="?attr/textAppearanceHeadlineMedium" android:textColor="@color/sidewalk_gray" android:textSize="14sp" android:layout_marginBottom="12dp"/>

                    <androidx.recyclerview.widget.RecyclerView android:id="@+id/match_log_recyclerview" android:layout_width="match_parent" android:layout_height="200dp" android:nestedScrollingEnabled="false"/>
                </LinearLayout>
            </com.google.android.material.card.MaterialCardView>

            <com.google.android.material.card.MaterialCardView android:id="@+id/formations_card" style="?attr/materialCardViewElevatedStyle" android:layout_width="0dp" android:layout_height="wrap_content" android:layout_marginTop="16dp" app:cardBackgroundColor="@android:color/transparent" app:cardElevation="4dp" app:shapeAppearance="@style/ShapeAppearance.App.StreetCard" app:layout_constraintTop_toBottomOf="@id/match_log_card" app:layout_constraintStart_toStartOf="parent" app:layout_constraintEnd_toEndOf="parent">

                <LinearLayout android:layout_width="match_parent" android:layout_height="wrap_content" android:background="@drawable/bg_concrete_card" android:orientation="vertical" android:padding="16dp">

                    <TextView android:layout_width="wrap_content" android:layout_height="wrap_content" android:text="FORMATIONS" android:textAppearance="?attr/textAppearanceHeadlineMedium" android:textColor="@color/sidewalk_gray" android:textSize="14sp" android:layout_marginBottom="12dp"/>

                    <LinearLayout android:layout_width="match_parent" android:layout_height="wrap_content" android:orientation="horizontal">

                        <LinearLayout android:layout_width="0dp" android:layout_height="wrap_content" android:layout_weight="1" android:orientation="vertical" android:layout_marginEnd="8dp">

                            <TextView android:id="@+id/team1_formation_label" android:layout_width="wrap_content" android:layout_height="wrap_content" android:text="Team 1 (4-4-2)" android:textAppearance="?attr/textAppearanceHeadlineSmall" android:textColor="?attr/colorPrimary" android:layout_marginBottom="8dp"/>

                            <it.vantaggi.scoreboardessential.views.FormationView android:id="@+id/team1_formation_view" android:layout_width="match_parent" android:layout_height="200dp"/>
                        </LinearLayout>

                        <LinearLayout android:layout_width="0dp" android:layout_height="wrap_content" android:layout_weight="1" android:orientation="vertical" android:layout_marginStart="8dp">

                            <TextView android:id="@+id/team2_formation_label" android:layout_width="wrap_content" android:layout_height="wrap_content" android:text="Team 2 (4-3-3)" android:textAppearance="?attr/textAppearanceHeadlineSmall" android:textColor="?attr/colorSecondary" android:layout_marginBottom="8dp"/>

                            <it.vantaggi.scoreboardessential.views.FormationView android:id="@+id/team2_formation_view" android:layout_width="match_parent" android:layout_height="200dp"/>
                        </LinearLayout>
                    </LinearLayout>
                </LinearLayout>
            </com.google.android.material.card.MaterialCardView>

            <!-- Action Buttons -->
            <LinearLayout android:layout_width="0dp" android:layout_height="wrap_content" android:orientation="horizontal" android:gravity="center_vertical" android:layout_marginTop="24dp" android:layout_marginBottom="80dp" app:layout_constraintTop_toBottomOf="@id/formations_card" app:layout_constraintStart_toStartOf="parent" app:layout_constraintEnd_toEndOf="parent" app:layout_constraintBottom_toBottomOf="parent">

                <com.google.android.material.button.MaterialButton android:id="@+id/match_history_button" style="@style/Widget.App.Button.Street" android:layout_width="0dp" android:layout_height="wrap_content" android:layout_weight="1" android:text="HISTORY" android:layout_marginEnd="8dp"/>

                <com.google.android.material.button.MaterialButton android:id="@+id/reset_scores_button" style="@style/Widget.App.Button.Street" android:layout_width="0dp" android:layout_height="wrap_content" android:layout_weight="1" android:text="END MATCH"/>

                <com.google.android.material.button.MaterialButton android:id="@+id/share_match_button" style="@style/Widget.App.Button.TextButton.Street" android:layout_width="wrap_content" android:layout_height="wrap_content" android:layout_marginStart="8dp" android:text="Share" app:icon="@drawable/ic_share" />
            </LinearLayout>
        </androidx.constraintlayout.widget.ConstraintLayout>
    </androidx.core.widget.NestedScrollView>

    <!-- FAB for Player Management -->
    <com.google.android.material.floatingactionbutton.FloatingActionButton android:id="@+id/players_fab" android:layout_width="wrap_content" android:layout_height="wrap_content" android:layout_gravity="bottom|end" android:layout_margin="16dp" app:backgroundTint="?attr/colorSecondary" app:tint="?attr/colorOnSecondary" app:shapeAppearance="@style/ShapeAppearance.App.StreetButton" app:srcCompat="@drawable/ic_person_add" android:contentDescription="@string/cd_manage_players"/>

    <!-- FAB for Statistics -->
    <com.google.android.material.floatingactionbutton.FloatingActionButton android:id="@+id/stats_fab" android:layout_width="wrap_content" android:layout_height="wrap_content" android:layout_gravity="bottom|start" android:layout_margin="16dp" app:backgroundTint="?attr/colorPrimary" app:tint="?attr/colorOnPrimary" app:shapeAppearance="@style/ShapeAppearance.App.StreetButton" app:srcCompat="@drawable/ic_stats" android:contentDescription="Statistics"/>

</androidx.coordinatorlayout.widget.CoordinatorLayout>
